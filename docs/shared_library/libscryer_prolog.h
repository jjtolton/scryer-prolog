/* Package version: 0.9.4 */

#pragma once

/* Generated with cbindgen:0.27.0 */

/* Warning, this file is autogenerated by cbindgen. Don't modify this manually. */



#define SCRYER_MAX_ARITY 1023

typedef struct SCRYER_Machine SCRYER_Machine;

typedef struct SCRYER_QueryState SCRYER_QueryState;

#ifdef __cplusplus
extern "C" {
#endif // __cplusplus

/**
 * Consults a Scryer Prolog module from a string, optionally with a given module name.
 * Will panic if provided invalid Scryer Prolog code.
 *
 * # Safety
 *
 * * `machine` must be a valid mutable pointer to a [`Machine`] created by
 * [`machine_new`] that has not yet been freed.
 * * `input` must be a valid pointer to a null terminated UTF-8 string of valid
 * Scryer Prolog code that satisfies the safety requirements of [`CStr::from_ptr`].
 * * `module_name`, must be a valid pointer to a null terminated UTF-8 string
 * of a valid Prolog module name that satisfies the safety requirements of
 * [`CStr::from_ptr`].
 * * there must be no [`QueryState`] for this [`Machine`] that has been created by
 * [`run_query_iter`] that has not yet been freed by
 * [`query_state_free`], or the [`Machine`] will enter an undefined state
 * with unpredictable behavior.
 *
 * # Arguments
 *
 * * `machine` - A mutable reference to the [`Machine`] to load the module into.
 * * `module_name` - A pointer to a null-terminated UTF-8 string representing
 * Scryer Prolog module name.
 * * `input` - A pointer to a null-terminated UTF-8 string representing Scryer Prolog code.
 *
 */
void scryer_consult_module_string(struct SCRYER_Machine *machine,
                                  const char *module_name,
                                  const char *input);

/**
 * Deallocate a Scryer Prolog string.
 *
 * # Safety
 *
 * * it is the caller's responsibility to ensure the `ptr` is not deallocated more than
 * once.
 */
void scryer_free_c_string(char *ptr);

/**
 * Frees the memory occupied by a [`Machine`] object.
 *
 * # Safety
 *
 * * It is the caller's responsibility to ensure that the input is a valid [`Machine`] pointer
 * created by [`machine_new`] that has not yet been freed by this function.
 * * Any [`QueryState`] instances associated with this machine should be deallocated prior
 * to calling this function on the input, otherwise those [`QueryState`] instances may
 * not be deallocated until the program terminates.
 *
 */
void scryer_machine_free(struct SCRYER_Machine *ptr);

/**
 * Create a new instance of the Scryer Machine.
 *
 *
 * It is the caller's responsibility to maintain a reference to the machine pointer
 * created by this function, passing it to [`machine_free`] to deallocate
 * resources. Failure to do so may lead to memory leaks.
 *
 */
struct SCRYER_Machine *scryer_machine_new(void);

/**
 * Cleans up the [`QueryState`] in the associated Scryer [`Machine`].
 *
 * # Safety
 *
 * * `query_state` must be a valid mutable pointer to a [`QueryState`] created by [`run_query_iter`]
 * that has not yet been freed by [`query_state_free`].
 * * There can be only one [`QueryState`] per [`Machine`] started by
 * [`run_query_iter`] that has not yet been freed with
 * [`query_state_free`] or the [`Machine`] state will enter an undefined
 * configuration with unpredictable results.
 */
void scryer_query_state_free(struct SCRYER_QueryState *query_state);

/**
 * Greedily evaluate a prolog query, returning all results in a JSON-formatted string.
 * Errors are printed to stderr and a null pointer is returned.
 *
 * # Safety
 *
 * * `machine` must be a valid [`Machine`] pointer created with [`machine_new`]
 * that has not yet been freed.
 * * There must be no existing [`QueryState`] for this [`Machine`] started by
 * [`run_query_iter`] that has not yet been freed with
 * [`query_state_free`] or the [`Machine`] state will enter an undefined
 * configuration with unpredictable results.
 * * it is the responsibility of the caller to deallocate the pointer returned by
 * this function with [`scyer_free_c_string`] in order to avoid memory leaks.
 *
 *
 * # Returns
 * - Returns a pointer to a JSON formatted, null terminated UTF-8 string
 *
 * # Response Format
 * ```json
 * // if result is a binding
 *
 * // current limitation is that only concrete (equality) bindings are returned,
 * // residual goals not yet supported.
 * {
 *   "status": "ok",
 *   "result": [{ ... }],
 * }
 *
 * // if result is a boolean goal
 *
 * {
 *   "status": "ok",
 *   "result": boolean
 * }
 */
char *scryer_run_query(struct SCRYER_Machine *machine, const char *input);

/**
 * Returns a new query generator for the given virtual machine.  Null pointer returned
 * if string is not valid UTF-8.
 *
 * # Safety
 *
 * Caller must satisfy the following preconditions for this function:
 *
 * * Valid [`Machine`] pointer created with [`machine_new`] that has not yet been freed.
 * * the input fulfill the safety requirements of [`CStr::from_ptr`].
 * * There must be no other [`QueryState`] for this [`Machine`] started by
 * [`run_query_iter`] that has not yet been freed with
 * [`query_state_free`] or the [`Machine`] state will enter an undefined
 * configuration with unpredictable results.
 *
 * Other concerns:
 * * after invoking this function, calling any other function besides [`run_query_next`]
 * before invoking [`query_state_free`] on the [`QueryState`] pointer
 * will leave the [`Machine`] in an undefined state
 *
 */
struct SCRYER_QueryState *scryer_run_query_iter(struct SCRYER_Machine *machine, const char *input);

/**
 * Returns a NULL POINTER if no addition iterations, else returns a
 * UTF-8 encoded JSON string with one iteration of results from a Scryer Prolog query.
 *
 * See documentation for known limitations (e.g., concrete goals only).
 *
 * # Safety
 *
 * * `query_state` must be a valid mutable pointer to a [`QueryState`] created by [`run_query_iter`]
 * that has not yet been freed by [`query_state_free`].
 * * There can be only one [`QueryState`] per [`Machine`] started by
 * [`run_query_iter`] that has not yet been freed with
 * [`query_state_free`] or the [`Machine`] state will enter an undefined
 * configuration with unpredictable results.
 */
char *scryer_run_query_next(struct SCRYER_QueryState *query_state);

#ifdef __cplusplus
}  // extern "C"
#endif  // __cplusplus
